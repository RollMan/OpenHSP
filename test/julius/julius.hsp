#include "hsp3cl.as"

sockidx = 0
domain = "127.0.0.1"
PORT = 10500


sockopen sockidx, domain, PORT

if stat != 0 {
  mes "Error in opening socket"
  end
}

sdim buf, 65536

sdim words, 64, 128
ddim cm, 64


repeat -1
  sockget buf, 1000, sockidx
  if stat < 0 {
    mes "Error in recieving"
    end
  }
  idx = 0
  W_PREFIX = "WORD=\""
  W_POSTFIX = "\""
  CM_PREFIX = "CM=\""
  CM_POSTFIX = "\""
  W_PREFIX_LEN = 6
  W_POSTFIX_LEN = 1
  CM_PREFIX_LEN = 4
  CM_POSTFIX_LEN = 1

  mes buf

  pidx = 0
  repeat -1
    p1 = instr(buf, pidx, W_PREFIX)
    if p1 == -1 : break
    p2 = instr(buf, p1+W_POSTFIX_LEN, W_POSTFIX)
    if p2 == -1 : break
    word = strmid(buf, p1+W_POSTFIX_LEN, p2-(p1-W_POSTFIX_LEN))
    words(idx) = word
    idx = idx+1
    pidx = p2
    ; mes "*WORD = " + word + "."
  loop
loop

sockclose 0
