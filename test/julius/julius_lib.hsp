#include "hsp3cl.as"


sdim buf, 65536
sdim tmpbuf, 65536

#module 

#defcfunc init_julius int sockidx
  domain = "127.0.0.1"
  PORT = 10500
  sockopen sockidx, domain, PORT
  if stat != 0 {
    return -1
  }
  return 0

#defcfunc is_recieved int sockidx
  sockget tmpbuf@, 65536, 0
  if stat < 0 {
    return stat
  }
  buf@ = buf@ + tmpbuf@
  if instr(buf@, 0, ".") != -1 {
    return 1
  }
  return 0

#defcfunc julius_read int sockidx
  recv = buf@
  buf@ = ""
  return recv


#global

res = init_julius(0)
if res < 0 {
  mes "Failed to initialize julius."
  end
}

sdim words, 65536
repeat 10
  mes cnt
  is_recieved_res = is_recieved(0)
  if is_recieved_res < 0 {
    mes "Error in recieving"
    end
  }
  if is_recieved_res == 0 {
    words = julius_read(0)
    mes words
  }
loop

sockclose 0
